From 37d4b6206c91bd7e03ecd8ce35f45cf0d41586ff Mon Sep 17 00:00:00 2001
From: Andy Wilkinson <awilkinson@pivotal.io>
Date: Tue, 27 Oct 2015 09:11:55 +0000
Subject: [PATCH] DATAREDIS-435 - Fix potential NPE in
 RedisTestProfileValueSource.

---
 .../org/springframework/data/redis/RedisTestProfileValueSource.java   | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/src/test/java/org/springframework/data/redis/RedisTestProfileValueSource.java b/src/test/java/org/springframework/data/redis/RedisTestProfileValueSource.java
index 33a7ecf..0e1a6bb 100644
--- a/src/test/java/org/springframework/data/redis/RedisTestProfileValueSource.java
+++ b/src/test/java/org/springframework/data/redis/RedisTestProfileValueSource.java
@@ -109,6 +109,10 @@ public class RedisTestProfileValueSource implements ProfileValueSource {
 	}
 
 	public static boolean matches(String key, String value) {
+
+		if (INSTANCE == null) {
+			INSTANCE = new RedisTestProfileValueSource();
+		}
 		return INSTANCE.get(key) != null ? INSTANCE.get(key).equals(value) : value == null;
 	}
 }
-- 
2.2.1

